<!DOCTYPE html>
<html lang="en">
<head>
    <title>Animation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="drawings.js"></script>
    <script src="objects.js"></script>
</head>
<body>
    <canvas id="drawing"></canvas>
    <script>
        'use strict';
        let context = document.getElementById("drawing").getContext("2d");
        let w = context.canvas.width = window.innerWidth;
        let h = context.canvas.height= window.innerHeight - 20;
        
        // constructor(mass, x, y, x_speed, y_speed, rotation_speed)
        let asteroids = [];
        for (let i = 0; i < 20; i++) {
            asteroids.push( 
                new Asteroid(
                    Math.max(2000, (Math.random() + 1) * 2000),  // Mass 
                    Math.random() * w,                           // x
                    Math.random() * h,                           // y
                    Math.random() * 100,                         // x_speed
                    Math.random() * -100,                        // y_speed
                    Math.random() * 2),                          // rotation_speed
            );
        } 
        let ship = new Ship(w/2, h/2);
        

        function draw(context, guide) {
            context.clearRect(0,0,context.canvas.width,context.canvas.height);
            if (guide) {
                draw_grid(context);
            }
            asteroids.forEach((asteroid) => {
                asteroid.draw(context, guide);
            });
            ship.draw(context, guide);
        }
        function update(elapsed) {
            asteroids.forEach((asteroid) => {
                asteroid.update(elapsed, context);
            });
            if(Math.abs(ship.speed()) < 15) {
                ship.angle += Math.PI * 2 * 0.01;
            }
            if(Math.abs(ship.speed()) > 100) {
                ship.angle = ship.movement_angle() + Math.PI;
            }
            // push in the direction its pointing (thrusters?)
            ship.push(ship.angle, 1000, elapsed)
            asteroids.forEach(function(asteroid) {
                asteroid.update(elapsed, context);
            })
            ship.update(elapsed, context);
        }
        var previous, elapsed;
        function frame(timestamp) {
            if (!previous) {
                previous = timestamp;
            }
            elapsed = timestamp - previous;
            update(elapsed / 1000);
            draw(context, false);
            previous = timestamp;
            window.requestAnimationFrame(frame);
        } 
        window.requestAnimationFrame(frame);

    </script>
</body>
</html>